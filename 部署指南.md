# Shopify MCP 服务器部署指南

## 📋 前提条件

✅ 已创建项目文件  
✅ Shopify API 令牌：`your_shopify_access_token_here`  
✅ 店铺域名：`happier-shopping-3.myshopify.com`

---

## 🚀 方法一：通过 Vercel 网页界面部署（推荐，最简单）

### 步骤 1：准备 GitHub 仓库

1. **在 GitHub 创建新仓库**
   - 访问 https://github.com/new
   - 仓库名称：`shopify-mcp-server`
   - 选择 Public（公开）
   - 点击 "Create repository"

2. **上传代码到 GitHub**
   ```bash
   cd shopify-mcp-server
   git init
   git add .
   git commit -m "Initial commit: Shopify MCP Server"
   git branch -M main
   git remote add origin https://github.com/你的用户名/shopify-mcp-server.git
   git push -u origin main
   ```

### 步骤 2：在 Vercel 部署

1. **访问 Vercel**
   - 打开 https://vercel.com
   - 使用 GitHub 账号登录（如果没有账号，先注册）

2. **导入项目**
   - 点击 "Add New..." → "Project"
   - 选择您刚创建的 GitHub 仓库 `shopify-mcp-server`
   - 点击 "Import"

3. **配置项目**
   - Framework Preset: 选择 "Other" 或 "Node.js"
   - Root Directory: 保持默认（`./`）
   - Build Command: 留空
   - Output Directory: 留空
   - Install Command: `npm install`

4. **设置环境变量**
   - 在 "Environment Variables" 部分，添加以下变量：
   
   | 变量名 | 值 |
   |--------|-----|
   | `SHOPIFY_STORE` | `happier-shopping-3.myshopify.com` |
   | `SHOPIFY_ACCESS_TOKEN` | `your_shopify_access_token_here` |

5. **部署**
   - 点击 "Deploy" 按钮
   - 等待部署完成（通常 1-2 分钟）

6. **获取部署地址**
   - 部署成功后，Vercel 会提供一个 URL
   - 格式类似：`https://shopify-mcp-server-xxxxx.vercel.app`
   - **复制这个 URL，稍后在 Dify 中使用**

---

## 🖥️ 方法二：使用 Vercel CLI 部署

### 步骤 1：安装 Vercel CLI

```bash
npm install -g vercel
```

### 步骤 2：登录 Vercel

```bash
vercel login
```
按照提示在浏览器中完成登录

### 步骤 3：部署

```bash
cd shopify-mcp-server
vercel
```

按照提示：
- Set up and deploy? → 输入 `Y`
- Which scope? → 选择您的账号
- Link to existing project? → 输入 `N`
- What's your project's name? → 输入 `shopify-mcp-server`
- In which directory is your code located? → 输入 `./`

### 步骤 4：设置环境变量

```bash
vercel env add SHOPIFY_STORE
# 输入值：happier-shopping-3.myshopify.com

vercel env add SHOPIFY_ACCESS_TOKEN
# 输入值：your_shopify_access_token_here
```

### 步骤 5：部署到生产环境

```bash
vercel --prod
```

### 步骤 6：获取部署地址

部署完成后，Vercel 会显示您的项目 URL，格式类似：
`https://shopify-mcp-server-xxxxx.vercel.app`

---

## ✅ 验证部署

部署完成后，访问以下 URL 验证：

1. **健康检查**：
   ```
   https://你的项目地址.vercel.app/health
   ```
   应该返回：
   ```json
   {
     "status": "ok",
     "service": "shopify-mcp-server",
     "store": "happier-shopping-3.myshopify.com",
     "token_configured": true
   }
   ```

2. **测试 MCP 端点**（使用 Postman 或 curl）：
   ```bash
   curl -X POST https://你的项目地址.vercel.app/ \
     -H "Content-Type: application/json" \
     -d '{
       "jsonrpc": "2.0",
       "method": "tools/list",
       "id": 1
     }'
   ```
   应该返回工具列表

---

## 🔗 在 Dify 中配置

### 步骤 1：登录 Dify

1. 访问 Dify 平台
2. 使用您的账号登录：
   - 邮箱：`social3085@social.helwan.edu.eg`
   - 密码：`Welcome@123`

### 步骤 2：添加 MCP 服务器

1. 在左侧导航栏，点击 **"工具"** → **"MCP"**
2. 点击 **"添加 MCP 服务器（HTTP）"** 按钮
3. 填写以下信息：
   - **服务器 URL**：`https://你的项目地址.vercel.app`
     - 例如：`https://shopify-mcp-server-xxxxx.vercel.app`
   - **名称**：`Shopify MCP`
   - **服务器标识符**：`shopify_mcp`
     - ⚠️ 注意：创建后无法更改
4. 点击 **"保存"**

### 步骤 3：验证连接

1. 保存后，Dify 会自动检测服务器
2. 如果看到工具列表（get_products, get_product_by_id, search_products），说明连接成功！

### 步骤 4：在应用中使用

1. 创建或编辑一个 Agent 应用
2. 在 "工具" 选项卡中，找到 "Shopify MCP" 下的工具
3. 添加需要的工具到应用中
4. 测试查询商品功能

---

## 🐛 常见问题

### 问题 1：部署失败

**解决方案**：
- 检查环境变量是否正确设置
- 确保 `vercel.json` 文件存在
- 查看 Vercel 部署日志

### 问题 2：Dify 无法连接

**解决方案**：
- 确认服务器 URL 正确（包含 `https://`）
- 访问 `/health` 端点验证服务器是否运行
- 检查 Vercel 项目是否已部署成功

### 问题 3：工具调用失败

**解决方案**：
- 检查 Shopify API 令牌是否有效
- 确认 Shopify 店铺域名正确
- 查看 Vercel 函数日志

---

## 📝 重要提示

1. **环境变量安全**：
   - 不要将 `.env` 文件提交到 GitHub
   - 在 Vercel 中设置环境变量，而不是硬编码在代码中

2. **API 令牌安全**：
   - 不要公开分享您的 Shopify API 令牌
   - 如果令牌泄露，立即在 Shopify 后台重新生成

3. **服务器标识符**：
   - 在 Dify 中创建后无法更改
   - 请谨慎填写

---

## 🎉 完成！

部署成功后，您就可以在 Dify 中使用 Shopify MCP 工具查询商品了！

如有问题，请查看：
- Vercel 部署日志
- Dify 错误提示
- 服务器健康检查端点

